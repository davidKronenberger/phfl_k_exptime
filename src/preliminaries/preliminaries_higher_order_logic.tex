%%
%% Author: Davidov
%% 16.05.2018
%%


\section{Higher Order Logic}\label{sec:higherOrderLogic}

For comparing the complexity classes with PHFL, we have to detour over combinations of extensions of FO. The first well
known extension is called Higher Order Logic~\cite{vanBenthem2001higher}, abbreviated with HO. In HO we
increase the expressive power of FO by allowing relation variables over any order. For this, we have to define the
types of higher order variables.

\subsection{HO Syntax}\label{subsec:hoSyntax}

\begin{definition}
    \emph{HO types} are given by the grammar
    \[ \tau \Coloneqq \odot \mid (\tau, \dots, \tau) \]
\end{definition}

The HO type of individuals is $\tau = \odot$. These objects have the \textit{HO order} $1$. The HO type $\tau = (\tau',
\dots, \tau')$ is that of relations between objects of HO type $\tau'$ and have the HO order $1 + order(\tau')$. For
each HO type we have a countably infinite set of variables. Furthermore, let $\sigma$ be a signature over an
relational vocabulary i.e. holding only relations of arbitrary HO types.

\begin{definition}
    Let $\mathcal{V} = \{X_1, X_2, \dots \}$ a countable infinite set of variables $\sigma$ a signature, then \emph{HO
    formulas} $\Phi, \Psi, \dots$ over $\sigma$ are defined by the grammar
    \[\Phi, \Psi \Coloneqq R(x_1, \dots, x_n) \mid Y(y_1, \dots, y_n) \mid \neg \Phi \mid \Phi \vee \Psi \mid \exists
    (X \colon \tau).\,\Phi\]
    where
    \begin{compactitem}
        \item $R \in \sigma$ is a relation of individuals with arity $n$ and $x_1, \dots, x_n \in \mathcal{V}$ of HO
        type $\odot$,
        \item $Y \in \mathcal{V}$ of HO type $(\tau', \dots, \tau')$ and $y_1, \dots, y_n \in \mathcal{V}$ of HO type
        $\tau'$ respectively and
        \item $X \in \mathcal{V}$ of HO type $\tau$.
    \end{compactitem}
\end{definition}

\subsection{HO Semantics}\label{subsec:hoSemantics}

The first step in direction of the semantics of HO formulas is to interpret the universes of the different HO types.

\begin{definition}
    Let $\mathcal{A}$ be a $\sigma$-structure over universe $\mathcal{U}$ then the universes of the
    HO types are defined inductively as follows:
    \begin{compactitem}
        \item $D_\odot(\mathcal{U}) = \mathcal{U}$,
        \item $D_{(\tau, \dots, \tau)}(\mathcal{U}) = \mathcal{P}(D_{\tau}(\mathcal{U})^n)$
    \end{compactitem}
\end{definition}

Moreover, $\alpha$ is a function that assigns all variables to an element of the appropriate universe, i.e. if
variable $X$ is of HO type $\tau$, then $\alpha(X) \in D_{\tau}(\mathcal{U})$. With $\alpha[X \rightarrow \mathcal{X}]$,
where $\mathcal{X} \in D_\tau(\mathcal{U})$ and $X$ of HO type $\tau$, we mean the variable assignment $\alpha'$,
where $\alpha'(X) = \mathcal{X}$ and $\alpha'(Y) = \alpha(Y)$ for all $Y \neq X$.

\begin{definition}
    Let $\mathcal{A}$ be a $\sigma$-structure and $\alpha$ a variable assignment over universe $\mathcal{U}$. The
    semantics of a HO formula is defined inductively as follows:
    \begin{compactitem}
        \item $\mathcal{A}, \alpha \models R(x_1, \dots x_n)$ iff $(\alpha(x_1), \dots
        \alpha(x_n)) \in R^{\mathcal{A}}$,
        \item $\mathcal{A}, \alpha \models Y(y_1, \dots y_n)$ iff $(\alpha(y_1), \dots
        \alpha(y_n)) \in \alpha(Y)$,
        \item $\mathcal{A}, \alpha \models \neg\varphi$ iff $\mathcal{A}, \alpha\not\models\varphi$,
        \item $\mathcal{A}, \alpha \models \varphi \vee \psi$ iff $\mathcal{A}, \alpha\models\varphi$ or $\mathcal{A},
        \alpha\models\psi$,
        \item $\mathcal{A}, \alpha \models \exists (X\colon\tau).\,\varphi$ iff there exists $\mathcal{X} \in D_{\tau}
        (\mathcal{U})$ with $\mathcal{A}, \alpha[X \rightarrow \mathcal{X}] \models \varphi$
        \end{compactitem}
\end{definition}

We can categorize the formulas by the order of all occurring variables. With HO$^k$ we mean the set of all those
formulas whose variables have order less or equal $k$.

\begin{example}{\cite{vanBenthem2001higher}}
    \label{example:ho}
    The following formula $\varphi$ describes Peano's induction axiom. Peano's induction axiom reveals that every set
    of natural numbers, which contains $0$ and is also closed under immediate successors, contains all natural numbers.
    \[\varphi = \forall P\colon(\odot).\,(P(0) \wedge \forall I\colon\odot.\,(P(I) \Rightarrow P(I + 1)) \Rightarrow
    \forall N \colon\odot.\,(P(N)))\]
    Note, that $\varphi$ lies in $\mathit{HO}^2$, i.e. it is a second order logic formula.
\end{example}

Another possibility to extend FO is to add operators that are not expressible in FO. Here, we are interested in two
of them, the least fixpoint and the partial fixpoint operator. Instead of defining the operators for FO we are
here interested to define this operators for HO. First, we regard the least fixpoint operator.

\subsection{HO + LFP}
\label{subsec:hoPlusLfp}

\begin{definition}
   Let $F\colon \mathscr{P}(A) \rightarrow \mathscr{P}(A)$ be an operator on a finite set $A$, then $X \in \mathscr{P}
   (A)$
   is called a \emph{fixpoint} of $F$ if $F(X) = X$. Let $X$ be a fixpoint of $F$, then $X$ is called the \emph{least
   fixpoint} of $F$, abbreviated as $\mathit{LFP}$($F$), if all other fixpoints $Y$ of $F$ including $X$ i.e. $X
   \subseteq Y$ for all fixpoints $Y$ of $F$.
\end{definition}

From Knaster-Tarski~\cite{tarski1955lattice} we know that if an operator $F\colon \mathscr{P}(A) \rightarrow
\mathscr{P}(A)$ is monotone $\mathit{LFP}$($F$) exists. $F$ is monotone iff for all $X, Y \subseteq A$ if $X
\subseteq Y$ then $F(X) \subseteq F(Y)$ holds.

\begin{example}
    \label{example:lfp}
    In remember to Example~\ref{example:ho} we can define Peano's induction axiom also with a least fixpoint
    operator. This example is mainly from~\cite{hetzl2017higher}. Let $A = \mathbb{Z}$ and $F(X) = X \cup \{0\} \cup
    \{x + 1 \mid x \in X\}$ the operator on $A$. Obviously, $F$ is monotone and fixpoints of $F$ are of the form
    $[-k, \infty[~\subseteq\mathbb{Z}$ for $k \in \mathbb{N}$. The least fixpoint of operator $F$ describes Peano's
    induction axiom, i.e. $\mathit{LFP}(F) = \mathbb{N}$.
\end{example}

Like in~\cite{freireMartins2011descriptive} we want to define special operators that are working on HO type
universes.

\begin{definition}
    Let $\sigma$ an arbitrary signature, $X$ a relation variable of HO type $\tau = (\tau', \dots, \tau')$,
    $\tau'$ an arbitrary HO type, $x_1, \dots x_n$ variables of HO type $\tau'$ and $\varphi(X, x_1, \dots, x_k)$ a
    formula over $\sigma$ with free variables $X, x_1, \dots, x_k$. For each $\sigma$-structure $\mathcal{A}$ with
    universe $\mathcal{U}$, $\varphi(A, a_1, \dots, a_k)$ induces the operator
    \begin{align*}
        F_\varphi^\mathcal{A}\colon\mathscr{P}(D_\tau(\mathcal{U})) &\longrightarrow \mathscr{P}(D_\tau(\mathcal{U}))\\
        A &\longmapsto F_\varphi^\mathcal{A}(A) \coloneqq \{(a_1, \dots, a_n) \mid \mathcal{A} \models \varphi(A, a_1,
        \dots, a_n)\}
    \end{align*}
    where $a_1 \dots, a_n \in D_{\tau'}(\mathcal{U})$.
\end{definition}

To make $F_\varphi^\mathcal{A}$ monotone we have to restrict $\varphi(X, x_1, \dots, x_k)$ in this way that variable
$X$ occurs in an even number of negations within of $\varphi$~\cite{freireMartins2011descriptive}. Those formulas
are called \textit{positive in} $X$. With this information we are able to define the least fixpoint operator for HO
formulas, denoted by HO($\mathit{LFP}$).

\begin{definition}
    Let $\sigma$ be a signature. The set of \emph{HO($\mathit{LFP}$) formulas} enhances the set of HO formulas with the
    following formation rule:
    \begin{compactitem}
        \item $[\mathit{LFP}\;\varphi(X, x_1, \dots, x_n)](v_1, \dots, v_n)$ is a HO
        ($\mathit{LFP}$) formula over $\sigma$ with free variables $v_1, \dots, v_n$ iff $\varphi(X, x_1, \dots, x_n)
        $ is a HO($\mathit{LFP}$) formula with free variables $X, x_1, \dots, x_n$, where $\varphi$ is positive in
        $X$, $X$ has HO type $\tau = (\tau', \dots, \tau')$, $x_1, v_1, \dots, x_n, v_n$ have HO type $\tau'$.
    \end{compactitem}
\end{definition}

As in HO, with HO($\mathit{LFP}$)$^k$ we mean the set of all those HO($\mathit{LFP}$) formulas whose variables have
order less or equal $k$.

\begin{definition}
    Let $\mathcal{A}$ be a $\sigma$-structure and $\alpha$ a variable assignment over universe $\mathcal{U}$. The
    semantics of a HO($\mathit{LFP}$) formula extends that of HO formulas with the following definition:
    \begin{compactitem}
        \item $\mathcal{A}, \alpha \models [\mathit{LFP}\;\varphi(X, x_1, \dots, x_n)](v_1, \dots,
        v_n)$ iff $(\alpha(v_1), \dots, \alpha(v_n)) \in \mathit{LFP}(F_\varphi^\mathcal{A})$.
    \end{compactitem}
\end{definition}

\begin{example}{\cite{freireMartins2011descriptive}}
    \label{example:ho_lfp} This example describes the reachability of two
    vertices in a graph. For this, let $\sigma = \{E\colon(\odot, \odot)\}$ our signature holding a binary relation
    representing the edges in a graph. Then
    \[[LFP\;(E(x_1, x_2) \vee \exists z\colon\odot.\,(E(x_1, z) \wedge X(z, x_2)))](s, t)\]
    describes the reachability of vertex $t$ from vertex $s$. Note, that $[LFP\;($ $E(x_1, x_2) \vee
    \exists z\colon\odot.\,(E(x_1, z) \wedge X(z, x_2)))]$ describes the transitive closure of $E$. This formula is
    one of $HO(LFP)^1$.
    %\[[LFP_{X,x}(\forall X:(\odot).\,(\forall Y:\odot.\,(X(Y) \vee Y = 0 \vee \exists Z:\odot.\,(X(Z) \wedge Y = (Z + 1)))
%))]\]
\end{example}

Since the $\mathit{LFP}$ operator restricts formulas to be positive in a variable, the next operator hasn't any
restriction. That means the number of negations on a variable can be odd or even.

\subsection{HO + PFP}\label{subsec:ho+Pfp}

Next, we define the partial fixpoint operator for HO formulas like in~\cite{schewe2006fixpoint}. For this, we define
first the partial fixpoint operator generally.

\begin{definition}
    Let $F\colon \mathscr{P}(A) \rightarrow \mathscr{P}(A)$ be an operator on a finite set $A$, then the \emph{partial
    fixpoint} of $F$, abbreviated as $\mathit{PFP}$($F$), is defined as follows:
    \[\mathit{PFP}(F)\coloneqq\begin{cases}
               F^{i+1}(\emptyset)=F^i(\emptyset),  & \text{if such } i \in \{0,\dots,|A|\} \text{ exists}\\
               \emptyset, & \text{otherwise,}
    \end{cases}\]
    where $F^0(\emptyset) = \emptyset$, $F^1(\emptyset) = F(\emptyset)$, $F^2(\emptyset) = F(F(\emptyset))$, and so on.
\end{definition}

Note, that for monotone $F$ holds $\mathit{PFP}(F)$ equals $\mathit{LFP}(F)$. With this knowledge we can define and
add the partial fixpoint operator to HO formulas, denoted as HO($\mathit{PFP}$).

\begin{definition}
    Let $\sigma$ be a signature. The set of \emph{HO($\mathit{PFP}$) formulas} enhances the set of HO formulas with the
    following formation rule:
    \begin{compactitem}
        \item $[\mathit{PFP}_{X, x_1, \dots, x_n}\varphi(X, x_1, \dots, x_n)](v_1, \dots, v_n)$ is a HO
        ($\mathit{PFP}$) formula over $\sigma$ with free variables $v_1, \dots, v_n$ iff $\varphi(X, x_1, \dots, x_n)
        $ is a HO($\mathit{PFP}$) formula with free variables $X, x_1, \dots, x_n$, where $X$ has HO type $\tau =
        (\tau', \dots, \tau')$, $x_1, v_1, \dots, x_n, v_n$ have HO type $\tau'$.
    \end{compactitem}
\end{definition}

HO($\mathit{PFP}$)$^k$ is the set of all those HO($\mathit{PFP}$) formulas whose variables have order less or equal $k$.

\begin{definition}
    Let $\mathcal{A}$ be a $\sigma$-structure and $\alpha$ a variable assignment over universe $\mathcal{U}$. The
    semantics of a HO($\mathit{PFP}$) formula extends that of HO formulas with the following definition:
    \begin{compactitem}
        \item $\mathcal{A}, \alpha \models [\mathit{PFP}\;\varphi(X, x_1, \dots, x_n)](v_1, \dots,
        v_n)$ iff $(\alpha(v_1), \dots, \alpha(v_n)) \in \mathit{PFP}(F_\varphi^\mathcal{A})$.
    \end{compactitem}
\end{definition}

\begin{example}
    This example is mainly from~\cite{abiteboul1995computing}.
    \begin{align*}
    [PFP\;(&G(x, y) \wedge \neg \exists z\colon\odot.\,(G(x, z) \wedge G(z, y)) \vee \\
    &\exists z\colon\odot.\,(\neg G(x, z)\wedge\neg G(z, x) \wedge \neg G(y, z) \wedge G(z, y)))](s, t)
    \end{align*}
    This formula describes a graph $G$, where all edges between $(s, t)$ will be removed, if there is a path of
    length $2$ between $s$ and $t$. If there is a vertex that is not directly connected to $s$ or $t$, an edge $(s,
    t)$ will be inserted. This process will be iterated while some changes occurs.

\end{example}

In the next chapter we want to compare the here defined HO($\mathit{PFP}$) and HO($\mathit{LFP}$) with PHFL from
Chapter~\ref{sec:polyadichigherorderfixpointlogic}.